@command
def test(app, shell="sh", debug=False):
    # XXX Restore this when check_program works on Windows
    # check_program(shell)

    if debug:
        ENV["DEBUG"] = "1"

    run(f"{shell} install.sh")
    run(f"{shell} uninstall.sh")

@command
def big_test(app, debug=False):
    test(app, debug=debug)

    if debug:
        ENV["DEBUG"] = "1"

    for shell in "bash", "dash", "ksh":
        if not which(shell):
            continue

        run(f"{shell} uninstall.sh") # No existing installation

        run(f"{shell} install.sh") # No existing installation and no existing backup
        run(f"{shell} install.sh") # Creates a backup
        run(f"{shell} install.sh") # Backs up the backup

        run(f"{shell} uninstall.sh") # No existing backup
        run(f"{shell} uninstall.sh") # Creates a backup
        run(f"{shell} uninstall.sh") # Backs up the backup

@command
def lint(app):
    check_program("shellcheck")

    run("shellcheck --enable all install.sh")
